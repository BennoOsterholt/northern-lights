---
- name: "LOOPS (https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html)"
  hosts: "magellan"
  gather_facts: yes
  become: yes

  vars_files:
    - /home/admin/MyScripts/apps/ansible/src/externalised_list_var.yml
    
  tasks:
  - name: add several users in a loop
    user:
      name: "{{ item }}"
      state: present
      groups: "users"
    loop:
       - finch
       - reese
       - simmons
       - wheeler

  - name: remove several users again
    user:
      name: "{{ item }}"
      state: absent
      groups: "users"
    loop:
       - finch
       - reese
       - simmons
       - wheeler

  - name: add several users from external YAML file
    debug:
      msg: "{{ name }}"
    loop: "{{ users }}"
    vars_files:
    - "/home/admin/MyScripts/apps/ansible/src/externalised_list_var.yml"
#    user:
#      name: "{{ user.name }}"
#      state: present
#      groups: "{{ user.groups }}"
    tags: 2nd